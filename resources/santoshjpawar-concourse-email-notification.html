<!DOCTYPE html>
<html lang="en">
<head>
    
    <title>Duty Free - Formatted Email</title>

    <link rel="stylesheet" type="text/css" href="/dutyfree/static/style.css">
</head>
<body>
<div class="container">
    <div class="logo-area">
        <div class="title">
            <h1>CONCOURSE DUTY FREE</h1>
        </div>
    </div>


    <div class="search">
    </div>

    <nav class="sidebar">
    </nav>

    <main class="content">

        <div class="breadcrumb">
        
        
            
                    <span class="breadcrumb-link"><a href="/dutyfree">Home</a></span>
                
        
            
                    <span>Formatted Email</span>
            
        
        </div>

        
    <section class="top-area">
        <h2>Formatted Email</h2>
        <div>
            <a target="_blank" href="https://github.com/santoshjpawar/concourse-email-notification">
                <img src="/dutyfree/static/GitHub-Mark-120px-plus.png" alt="Resource Source on Github"
                     class="github-icon-detail"
                     title="Resource Source on Github">
            </a>
            <a href="https://github.com/santoshjpawar" target="_blank" class="author">santoshjpawar</a>
        </div>
    </section>
    <section class="middle-area">
        <div class="description">
            <h3>Description</h3>
            <p class="desc">Can be used to send HTML formatted email notifications from Concourse.CI build.</p>
        </div>
    </section>
    <section id="github-readme">
        <h3>Read Me</h3>
        <div id="readme" class="instapaper_body md" data-path="README.md"><article class="markdown-body entry-content p-5" itemprop="text"><h1><a id="user-content-concourse-email-notification" class="anchor" aria-hidden="true" href="#concourse-email-notification"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>concourse-email-notification</h1>
<p>Can be used to send HTML formatted email notifications from Concourse.CI build.</p>
<p>Following are the <em>source</em> values:</p>
<ul>
<li><code>smtp_host</code> - SMTP host that you want to use to send email notifications. Default is <em>smtp.gmail.com</em></li>
<li><code>smtp_port</code> - SMTP server port to use. Default is <em>587</em></li>
<li><code>smtp_username</code> - SMTP user name.</li>
<li><code>smtp_password</code> - SMTP user password.</li>
<li><code>default_recepient</code> - Email address to send the notifications to. You can
provide multiple email addresses separated with <em>comma</em> and <em>space</em>.
For example, <em><a href="mailto:user1@domain1.com">user1@domain1.com</a>, <a href="mailto:user2@domain1.com">user2@domain1.com</a>, <a href="mailto:user3@domain2.com">user3@domain2.com</a></em>
This param will be ignored if the input directory contains file named
<code>author</code>. See below for more details on file <code>author</code>.</li>
</ul>
<p>Following are the <em>param</em> values</p>
<ul>
<li><code>input_dir</code> - Directory name under the incoming project artifacts directory where the following files can be placed:
<ul>
<li><code>pretext</code> - File containing a line of text to be used as email subject.</li>
<li><code>color</code> (optional) - File containing text either <code>good</code> or <code>warning</code> or <code>danger</code> or any hex color code (eg. <code>#439FE0</code>). This text will be used to determine if current Concourse build is successful or not. Email message will be formatted
based on that.</li>
<li><code>author</code> (optional) - File containing list of recepient email addresses
separated with <em>comma</em> and <em>space</em>. For example, <em><a href="mailto:user1@domain1.com">user1@domain1.com</a>, <a href="mailto:user2@domain1.com">user2@domain1.com</a>, <a href="mailto:user3@domain2.com">user3@domain2.com</a></em>.
If this file exists, then source param <code>default_recepient</code> will be ignored.</li>
<li><code>replacements</code> (optional) - File containing list of key/value pairs to be replaced in message body.
For example, if message body (param <code>email_body</code>) contains lines <code>Project - PROJECT_NAME</code>
and <code>Status - STATUS</code>, there could be a file <em>replacements</em> created in the incoming
directory with lines <code>PROJECT_NAME=My-Project</code> and <code>STATUS=Success</code>. So the resultant email will
have lines as <code>Project - My-Project</code> and <code>Status - Success</code>.</li>
</ul>
</li>
<li><code>email_body</code> (optional) - Email body in HTML format. There can be placeholders which will be
replaced by the values in output file <em>replacements</em> as explained above.
If not set, resource will send email with default message.</li>
</ul>
<p><strong>Note:</strong> When multiple email addresses are provided in <code>default_recipient</code> param or in the <code>author</code> file,
email will be sent with first email address as <em>To</em> and all email addresses as <em>Bcc</em>.</p>
<h3><a id="user-content-sample-pipeline" class="anchor" aria-hidden="true" href="#sample-pipeline"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sample pipeline</h3>
<p>Check an example pipeline from <code>sample-pipeline</code> directory.</p>
<ul>
<li><code>sample-pipeline.yml</code>:  Pipeline file <code>sample-pipeline.yml</code> has two resources.
This sample pipeline pulls the Git project that has the required input
files already created in the project directory. Normally, you would create those files dynamically from your
specific task in the pipeline. Before using this sample pipeline file,
<ul>
<li>Replace the values embedded between <strong>&lt;</strong> and <strong>&gt;</strong> with the actual value.</li>
<li>Values embedded between <strong>{{</strong> and <strong>}}</strong> will be taken from <code>credentials.yml</code> file
when setting the pipeline in Concourse using <em>fly</em> command.</li>
</ul>
</li>
<li><code>credentials.yml</code>: This file containes the SMTP nd Git authentication details.
Provide the correct values against the provided variables.</li>
</ul>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">smtp_user</span>: <span class="pl-s"><span class="pl-pds">"</span>&lt;smtp_user&gt;<span class="pl-pds">"</span></span>
<span class="pl-ent">smtp_password</span>: <span class="pl-s"><span class="pl-pds">"</span>&lt;smtp_password&gt;<span class="pl-pds">"</span></span>
<span class="pl-ent">github_key</span>: <span class="pl-s">|</span>
<span class="pl-s"></span> <span class="pl-s">-----BEGIN RSA PRIVATE KEY-----</span>
 <span class="pl-s">MIIEpAIBAAKCAQEAyivbqzRBC4vt9vAbNXq/YNw2bE5nACh/ssg3ycH8DZ+x1ZtC</span>
 <span class="pl-s">...</span>
 <span class="pl-s">1xOLjeur1gELnako2EK1MBb/+/fETO26TQLLpZzdnvCQ97INNrn66w==</span>
 <span class="pl-s">-----END RSA PRIVATE KEY-----</span>
<span class="pl-ent">email_body</span>: <span class="pl-s">|</span>
<span class="pl-s">  &lt;html&gt;</span>
<span class="pl-s">    &lt;body&gt;</span>
<span class="pl-s">      &lt;p style="font-family:verdana;font-size:13"&gt;</span>
<span class="pl-s">        Hello,&lt;/br&gt;</span>
<span class="pl-s">        &lt;/br&gt;</span>
<span class="pl-s">        ...</span>
<span class="pl-s">        &lt;/br&gt;</span>
<span class="pl-s">        Thanks,&lt;/br&gt;</span>
<span class="pl-s">        Danube Concourse CI</span>
<span class="pl-s">      &lt;/p&gt;</span>
<span class="pl-s">    &lt;/body&gt;</span>
<span class="pl-s">  &lt;/html&gt;</span></pre></div>
<p>Once you update these yaml files, you can set the pipeline in Concourse using following command,</p>
<p><em>fly -t  set-pipeline -p concourse-email-notification -c sample-pipeline.yml -l credentials.yml</em></p>
<p>Then unpause the pipeline from Concourse UI or by executing following command,</p>
<p><em>fly -t  unpause-pipeline -p concourse-email-notification</em></p>
<h2><a id="user-content-building-docker-image" class="anchor" aria-hidden="true" href="#building-docker-image"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building docker image</h2>
<p>Makefile is provided to build the Docker image with following <em>targets</em>.</p>
<ul>
<li><em>make push</em> - This will build the Docker image and push it to Docker registry.
Make sure to change the repo name to your repo in <em>Makefile</em> before
building and pushing.</li>
</ul>
<h2><a id="user-content-authorize-the-device" class="anchor" aria-hidden="true" href="#authorize-the-device"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Authorize the device</h2>
<p>Gmail blocks the unknown device used to send the email. When sending an email from any new device, you will get an error something like this...</p>
<pre><code>534-5.7.14 Please log in via your web browser and 534-5.7.14 then try again. 534-5.7.14 Learn more at 534 5.7.14 https://support.google.com/mail/answer/78754 hw7sm51688135pac.12 - gsmtp 
</code></pre>
<p>In that case, you may need to authorize the device by logging into the Google account.</p>
</article></div>
    </section>


    </main>
</div>
</body>
</html>





